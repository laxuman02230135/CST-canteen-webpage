"use strict";(()=>{var e={};e.id=991,e.ids=[991],e.modules={3524:e=>{e.exports=require("@prisma/client")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3867:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>y,patchFetch:()=>g,requestAsyncStorage:()=>l,routeModule:()=>c,serverHooks:()=>m,staticGenerationAsyncStorage:()=>d});var i={};r.r(i),r.d(i,{GET:()=>p,POST:()=>u});var a=r(9303),n=r(8716),s=r(670);let o=new(r(3524)).PrismaClient;async function p(){try{let e=(await o.order.findMany({include:{items:!0},orderBy:{createdAt:"desc"}})).map(e=>({...e,total:`Nu. ${e.total}`,items:e.items.map(e=>({...e,price:`Nu. ${parseFloat(e.price.replace(/[^0-9.]/g,""))||0}`}))}));return new Response(JSON.stringify(e),{status:200,headers:{"Content-Type":"application/json"}})}catch(e){return console.error("Order fetch error:",e),new Response(JSON.stringify({message:"Failed to fetch orders"}),{status:500,headers:{"Content-Type":"application/json"}})}}async function u(e){try{let{name:t,email:r,phone:i,pickupTime:a,specialInstructions:n,items:s,total:p}=await e.json();if(!t?.trim()||!r?.trim()||!i?.trim()||!a?.trim())return new Response(JSON.stringify({error:"Name, email, phone, and pickup time are required"}),{status:400,headers:{"Content-Type":"application/json"}});if(!s||!Array.isArray(s)||0===s.length)return new Response(JSON.stringify({error:"At least one item is required in the order"}),{status:400,headers:{"Content-Type":"application/json"}});let u="string"==typeof p?parseFloat(p.replace(/[^0-9.]/g,"")):p;if(isNaN(u)||u<=0)return new Response(JSON.stringify({error:"Invalid total amount"}),{status:400,headers:{"Content-Type":"application/json"}});let c=s.map((e,t)=>{let r=parseFloat(e.price.replace(/[^0-9.]/g,""));if(!e.title?.trim()||!e.description?.trim()||isNaN(r)||r<0)throw Error(`Invalid item at index ${t}: title, description, and valid price are required`);return{title:e.title,description:e.description,price:`Nu. ${r.toFixed(2)}`,image:e.image||""}}),l=await o.order.create({data:{name:t,email:r,phone:i,pickupTime:a,specialInstructions:n||"",total:u,items:{create:c}},include:{items:!0}}),d={...l,total:`Nu. ${l.total}`,items:l.items.map(e=>({...e,price:e.price}))};return new Response(JSON.stringify(d),{status:201,headers:{"Content-Type":"application/json"}})}catch(e){return console.error("Error creating order:",e),new Response(JSON.stringify({error:e.message||"Failed to create order"}),{status:500,headers:{"Content-Type":"application/json"}})}finally{await o.$disconnect()}}let c=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/menu/route",pathname:"/api/menu",filename:"route",bundlePath:"app/api/menu/route"},resolvedPagePath:"D:\\CST-canteen-webpage\\app\\api\\menu\\route.js",nextConfigOutput:"",userland:i}),{requestAsyncStorage:l,staticGenerationAsyncStorage:d,serverHooks:m}=c,y="/api/menu/route";function g(){return(0,s.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:d})}},9303:(e,t,r)=>{e.exports=r(517)}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[948],()=>r(3867));module.exports=i})();