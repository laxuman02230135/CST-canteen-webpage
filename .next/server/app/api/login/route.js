"use strict";(()=>{var e={};e.id=740,e.ids=[740],e.modules={3524:e=>{e.exports=require("@prisma/client")},7096:e=>{e.exports=require("bcrypt")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:e=>{e.exports=require("buffer")},4770:e=>{e.exports=require("crypto")},6162:e=>{e.exports=require("stream")},1764:e=>{e.exports=require("util")},5915:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>y,patchFetch:()=>w,requestAsyncStorage:()=>h,routeModule:()=>f,serverHooks:()=>x,staticGenerationAsyncStorage:()=>v});var i={};t.r(i),t.d(i,{POST:()=>g});var o=t(9303),a=t(8716),s=t(670),n=t(7070),p=t(5995),u=t(7096),l=t.n(u),c=t(1482),d=t.n(c),m=t(3183);async function g(e){try{let r=process.env.JWT_SECRET;if(!r)return console.error("JWT_SECRET environment variable is not set"),n.NextResponse.json({message:"Authentication service is not properly configured"},{status:500});let{email:t,password:i}=await e.json();if(console.log("Login attempt for email:",t),!t||!i)return console.log("Missing email or password"),n.NextResponse.json({message:"Email and password are required"},{status:400});let o=await p.Z.user.findUnique({where:{email:t.toLowerCase()}});if(!o)return console.log("User not found:",t),n.NextResponse.json({message:"Invalid login credentials"},{status:401});if(!await l().compare(i,o.password))return console.log("Invalid password for user:",t),n.NextResponse.json({message:"Invalid login credentials"},{status:401});let a=d().sign({userId:o.id,email:o.email},r,{expiresIn:"7d"}),s=(0,m.q)("token",a,{httpOnly:!0,secure:!0,sameSite:"lax",path:"/",maxAge:604800});console.log("Login successful for user:",t);let u=n.NextResponse.json({user:{name:o.name},message:"Login successful"},{status:200});return u.headers.set("Set-Cookie",s),u}catch(e){return console.error("Login error details:",{message:e.message,stack:e.stack,name:e.name}),n.NextResponse.json({message:"Something went wrong. Please try again later."},{status:500})}}let f=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/login/route",pathname:"/api/login",filename:"route",bundlePath:"app/api/login/route"},resolvedPagePath:"D:\\CST-canteen-webpage\\app\\api\\login\\route.js",nextConfigOutput:"",userland:i}),{requestAsyncStorage:h,staticGenerationAsyncStorage:v,serverHooks:x}=f,y="/api/login/route";function w(){return(0,s.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:v})}},5995:(e,r,t)=>{t.d(r,{Z:()=>o});var i=t(3524);let o=globalThis.prisma??new i.PrismaClient},3183:(e,r)=>{r.q=function(e,r,n){var p=n&&n.encode||encodeURIComponent;if("function"!=typeof p)throw TypeError("option encode is invalid");if(!i.test(e))throw TypeError("argument name is invalid");var u=p(r);if(!o.test(u))throw TypeError("argument val is invalid");var l=e+"="+u;if(!n)return l;if(null!=n.maxAge){var c=Math.floor(n.maxAge);if(!isFinite(c))throw TypeError("option maxAge is invalid");l+="; Max-Age="+c}if(n.domain){if(!a.test(n.domain))throw TypeError("option domain is invalid");l+="; Domain="+n.domain}if(n.path){if(!s.test(n.path))throw TypeError("option path is invalid");l+="; Path="+n.path}if(n.expires){var d=n.expires;if("[object Date]"!==t.call(d)||isNaN(d.valueOf()))throw TypeError("option expires is invalid");l+="; Expires="+d.toUTCString()}if(n.httpOnly&&(l+="; HttpOnly"),n.secure&&(l+="; Secure"),n.partitioned&&(l+="; Partitioned"),n.priority)switch("string"==typeof n.priority?n.priority.toLowerCase():n.priority){case"low":l+="; Priority=Low";break;case"medium":l+="; Priority=Medium";break;case"high":l+="; Priority=High";break;default:throw TypeError("option priority is invalid")}if(n.sameSite)switch("string"==typeof n.sameSite?n.sameSite.toLowerCase():n.sameSite){case!0:case"strict":l+="; SameSite=Strict";break;case"lax":l+="; SameSite=Lax";break;case"none":l+="; SameSite=None";break;default:throw TypeError("option sameSite is invalid")}return l};var t=Object.prototype.toString,i=(Object.prototype.hasOwnProperty,/^[!#$%&'*+\-.^_`|~0-9A-Za-z]+$/),o=/^("?)[\u0021\u0023-\u002B\u002D-\u003A\u003C-\u005B\u005D-\u007E]*\1$/,a=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,s=/^[\u0020-\u003A\u003D-\u007E]*$/}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),i=r.X(0,[948,972,482],()=>t(5915));module.exports=i})();